# Design of Elin Element Inspector

Elin Element Inspector (EEI)は、ElinにおけるElement IDの内容を表示するためのVSCode拡張機能です。このドキュメントでは、EEIの設計について説明します。

ElinのDecompileされたソースコードでは、Element IDが全て数値リテラルとして表示されています。そのためElementに関するコードを読み解くには、Element IDからそれの実態を手作業で見つけ出す必要があります。

EEIはこの問題を解決します。Element IDであることが自明である数値リテラルに対しては、その数値リテラルの横にElementの内容を表示します。
また任意の数値リテラルに対しても、ホバー時にElementの内容を表示します。

## データソース

ElementのIDとその内容は、data/elements.csvにCSV形式で保存されています。
id列をElement IDとして使用します。

## 機能の詳細

EEIは2つの機能を提供します。

1. 特定のパターンにマッチする数値リテラルの横にElementの内容を表示する。
1. 任意の数値リテラルに対してホバー時にElementの内容を表示する。

### 横表示

数値リテラルがElement IDであることが自明である場合、その横にElementの内容を表示します。

具体的には、特定の関数の指定された引数位置にある数値リテラルが対象となります。
対象の関数と引数の位置(1始まり)は以下のとおりです。

* `Evalue`, 1
* `HasElement`, 1
* `ModExp`, 1

関数と位置引数の組み合わせは設定で追加可能です。

細かい仕様として、以下を考慮する必要があります。

* 関数のレシーバが明示されているかどうかに関わらずマッチする。
* `Evalue(num1)`のように、引数が数値リテラルではない場合はマッチしない。
* `Evalue(flag ? 30 : 31)`のように、引数が数値リテラルを含む式である場合はマッチする。

### ホバー表示

数値リテラルが上記の関数外で用いられていた場合にも、それがElement IDである可能性があります。
そのような場合にも対応するため、任意の数値リテラルはホバー時にElementの内容を表示します。

## 表示フォーマット

表示のフォーマットはユーザーが設定可能です。デフォルトのフォーマットは`$alias/$name_JP`です。

フォーマット文字列中の`$`から始まる部分は、`elements.csv`の列名に対応しています。例えば`$alias`は`alias`列の内容に置き換えられます。
